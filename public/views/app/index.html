<div style="width: 100%;" ng-if="is_loading">
	<div class="progress">
		<div class="indeterminate"></div>
	</div>
</div>

<div id="" class="container" ng-if="!confirmed" ng-init="tab=1">

	<div class="spaced"></div>
	<ul class="nav nav-tabs">
		<li class="active"><a data-toggle="tab" ng-click="tab=1">Participant</a></li>
		<li><a data-toggle="tab" ng-click="tab=2">Organizer</a></li>
	</ul>

	<div class="tab-content">
		<div id="participant" class="tab-pane fade" ng-if="tab==1" ng-class="{'in active': tab==1}">
			<form class="form-credentials">
				<label for="api_key" class="sr-only">API Key</label>
				<input ng-model="fields.participant.full_url" type="text" id="url" class="form-control"
					   placeholder="Challonge URL" required autofocus>
				<div class="spaced text-center">
					<button ng-disabled="!fields.participant.full_url" class="btn btn-lg btn-primary"
							ng-click="validateParticipantCriteria();">Let's Go
					</button>
				</div>
			</form>
		</div>
		<div id="organizer" class="tab-pane fade" ng-if="tab==2" ng-class="{'in active': tab==2}">
			<form class="form-credentials">
				<label for="api_key" class="sr-only">API Key</label>
				<input ng-model="fields.organizer.api_key" type="text" id="api_key" class="form-control"
					   placeholder="API Key" required autofocus>
				<label for="subdomain" class="sr-only">Subdomain (optional)</label>
				<input ng-model="fields.organizer.subdomain" type="text" id="subdomain" class="form-control"
					   placeholder="Subdomain">
				<p class="muted text-center">
					Any information given is stored only in your browser, and nowhere else.
				</p>
				<div class="spaced text-center">
					<button ng-disabled="!fields.organizer.api_key" class="btn btn-lg btn-primary"
							ng-click="showAvailableTournaments();">Let's Go
					</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div id="chooseTournament" class="container" ng-if="confirmed && active_tournament.is_organizer && !active_tournament.tournament">
	<h1 class="text-center">Choose your Tournament</h1>

	<div class="text-center">
		<select class="form-control form-small inline input-sm" ng-model="session_data.settings.tournament_filter"
				ng-options="filter.name for filter in tournamentFilters" ng-change="showAvailableTournaments();">
		</select>
	</div>

	<div class="row spaced" ng-if="tournaments.length" class="tournament-list">
		<div class="col-sm-12 col-md-6 col-md-push-3">
			<ul class="list-group" ng-if="tournaments.length">
				<li class="list-group-item" ng-repeat="tournament in tournaments"
					ng-click="selectTournament(tournament);">

					{{tournament.tournament.name}}
          <span class="pull-right link">
              <a href="{{tournament.tournament.full_challonge_url}}" target="_blank"><i
					  class="fa fa-external-link-square" aria-hidden="true"></i>
              </a>
          </span>
				</li>
			</ul>
		</div>
	</div>

	<div class="row" ng-if="!tournaments.length && !is_loading">
		<div class="col-sm-12 text-center">
			<h2>No tournaments found.</h2>
		</div>
	</div>
</div>

<div id="activeTournament" layout="column" flex ng-if="!is_loading && confirmed && (active_tournament.tournament || !active_tournament.is_organizer)">

	<div>
		<h1 class="text-center">
			<a href="{{active_tournament.tournament.full_challonge_url}}" target="_blank">
				{{active_tournament.tournament.name}}
			</a>
		</h1>
		<div class="entrants">{{ active_tournament.tournament.participants_count }} entrants</div>
		<div class="progress">
			<!--<div class="determinate" style="width: {{ active_tournament.tournament.progress_meter }}%">
				{{ activeTournament.tournament.progress_meter + '%'}}
			</div>-->
			<div class="progress-bar"
				 role="progressbar"
				 aria-valuenow="{{ active_tournament.tournament.progress_meter }}"
				 aria-valuemin="0" aria-valuemax="100"
				 ng-style="{ width : (active_tournament.tournament.progress_meter + '%') }">
			</div>
		</div>

	</div>

	<div id="match-settings">
		<label class="checkbox-inline"><input type="checkbox" ng-model="session_data.settings.hide_completed">Hide Completed</label>
		<label class="checkbox-inline"><input type="checkbox" ng-model="session_data.settings.hide_unavailable">Hide Unavailable</label>
		<label class="checkbox-inline"><input type="checkbox" ng-model="session_data.settings.hide_stations">Hide Stations</label>
	</div>

	<div layout="row">
		<table id="matches-table" class="table table-hover">
			<thead>
			<tr>
				<th class="col-sm-1">
					Match
				</th>
				<th class="col-sm-5">
					Player 1
				</th>
				<th class="col-sm-5">
					Player 2
				</th>
				<th class="col-sm-1" ng-hide="session_data.settings.hide_stations">
					Station
				</th>
			</tr>
			</thead>
			<tbody>
			<tr ng-repeat="match in matches | orderBy:['match.order', 'match.suggested_play_order']"
				class="match-{{match.match.state}}"
				ng-hide="(session_data.settings.hide_completed && match.match.state=='complete') || (session_data.settings.hide_unavailable && match.match.state=='pending')"
				ng-click="editMatch(match)">
				<th scope="row">
					{{match.match.identifier}} ({{ determineRound(match.match.round) }})
				</th>
				<td ng-class="{'bold':match.match.winner_id && match.match.winner_id == match.match.player1_id}">
						<span class="player" ng-if="participants[match.match.player1_id]">
						  {{ participants[match.match.player1_id] }}
						</span>
						<span ng-if="!participants[match.match.player1_id] && Math.abs(match.match.round) >= Math.abs(match_ids[match.match.player1_prereq_match_id].round)">
						  {{ 'Winner of ' + match_ids[match.match.player1_prereq_match_id].id }}
						</span>
						<span ng-if="!participants[match.match.player1_id] && Math.abs(match.match.round) < Math.abs(match_ids[match.match.player1_prereq_match_id].round)">
						  {{ 'Loser of ' + match_ids[match.match.player1_prereq_match_id].id }}
						</span>
				</td>
				<td ng-class="{'bold':match.match.winner_id && match.match.winner_id == match.match.player2_id}">
						<span class="player" ng-if="participants[match.match.player2_id]">
						  {{ participants[match.match.player2_id] }}
						</span>
						<span ng-if="!participants[match.match.player2_id] && Math.abs(match.match.round) >= Math.abs(match_ids[match.match.player2_prereq_match_id].round)">
						  {{ 'Winner of ' + match_ids[match.match.player2_prereq_match_id].id }}
						</span>
						<span ng-if="!participants[match.match.player2_id] && Math.abs(match.match.round) < Math.abs(match_ids[match.match.player2_prereq_match_id].round)">
						  {{ 'Loser of ' + match_ids[match.match.player2_prereq_match_id].id }}
						</span>
				</td>
				<td ng-hide="session_data.settings.hide_stations" class="text-center">
					<input ng-if="active_tournament.is_organizer" ng-click="$event.stopPropagation()" placeholder="station"
						   class="form-control input-sm text-center station" ng-model="match.match.station"
						   ng-change="updateMatchStation(match, match.match.station)"
						   ng-model-options="{debounce:300}"/>
						<span ng-if="!active_tournament.is_organizer" class="station">
						  {{match.match.station}}
						</span>
				</td>
			</tr>
			</tbody>
		</table>
	</div>

</div>

<div class="modal fade" tabindex="-1" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
						aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">Modal title</h4>
			</div>
			<div class="modal-body">
				<p>One fine body&hellip;</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary">Save changes</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<!-- Button trigger modal -->
<!-- <button type="button" class="btn btn-primary btn-lg">
  Launch demo modal
</button> -->

<!-- Modal -->
<div class="modal fade" id="matchModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
						aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">Edit Match {{currentMatch.match.identifier}}</h4>
			</div>
			<div class="modal-body text-center"
				 ng-if="(!currentMatch.match.underway_at && !currentMatch.match.scores_csv)">
				<button class="btn btn-large btn-primary" ng-click="postMatchResults()">
					Start Match
				</button>

			</div>
			<div class="modal-body" ng-if="currentMatch.match.underway_at || currentMatch.match.scores_csv">
				<div class="winner text-center">
					<h3>Select Winner</h3>
					<div class="btn-group" role="group" aria-label="...">
						<button type="button" class="btn btn-default"
								ng-class="{'btn-primary': currentMatch.match.winner_id == currentMatch.match.player1_id}"
								ng-click="currentMatch.match.winner_id=currentMatch.match.player1_id">
							{{participants[currentMatch.match.player1_id]}}
						</button>
						<button type="button" class="btn btn-default"
								ng-class="{'btn-primary': currentMatch.match.winner_id == currentMatch.match.player2_id}"
								ng-click="currentMatch.match.winner_id=currentMatch.match.player2_id">
							{{participants[currentMatch.match.player2_id]}}
						</button>
					</div>
				</div>

				<div class="scores">

					<div class="input-group spaced">
						<span class="input-group-addon" id="basic-addon3">{{participants[currentMatch.match.player1_id]}}'s score</span>
						<input ng-model="currentMatch.match.player1_score" min="0" type="number" class="form-control"
							   aria-describedby="{{participants[currentMatch.match.player1_id]}}'s score">
					</div>

					<div class="input-group spaced">
						<span class="input-group-addon" id="basic-addon3">{{participants[currentMatch.match.player2_id]}}'s score</span>
						<input ng-model="currentMatch.match.player2_score" min="0" type="number" class="form-control"
							   aria-describedby="{{participants[currentMatch.match.player2_id]}}'s score">
					</div>

				</div>

			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">nvm</button>
				<button type="button" class="btn btn-primary" ng-click="postMatchResults()">Save</button>
			</div>
		</div>
	</div>
</div>